<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Sonic Pi</title>
    <link rel="stylesheet" href="codemirror/lib/codemirror.css">
    <script src="codemirror/lib/codemirror.js"></script>
    <script src="codemirror/addon/edit/matchbrackets.js"></script>
    <script src="codemirror/mode/ruby/ruby.js"></script>
    <style>
      .CodeMirror {border-top: 10px solid black; border-bottom: 10px solid black;}
      .cm-s-default span.cm-arrow { color: red; }
    </style>
  </head>
  <body>

    <form>
      <textarea id="code" name="foo"></textarea>
      <button id="run" onClick="sendCode()">Run!</button>
    </form>

    <div id="msgs"></div>
</body>
    <script>
      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
      mode: "text/x-ruby",
      tabMode: "indent",
      matchBrackets: true,
      indentUnit: 2,
      lineNumbers: true,
      value: "#foo"
      });
    </script>


  <script type="text/javascript">
    var ws       = new WebSocket('ws://' + window.location.host )
    window.onload = function(){
      (function(){
        var show = function(el){
          return function(msg){ el.innerHTML = msg + '<br />' + el.innerHTML; }
        }(document.getElementById('msgs'));
        ws.onopen    = function()  { show('websocket opened'); };
        ws.onclose   = function()  { show('websocket closed'); }
        ws.onmessage = function(m) { show('websocket message: ' +  m.data); };
      })();
    }

    function sendCode() {
      var input     = document.getElementById('code');
      ws.send(input.value);
      return false;
    }

  </script>

</html>
